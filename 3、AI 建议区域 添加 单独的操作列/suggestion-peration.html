<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monaco Editor - AI Code Suggestions Demo</title>
    <script src="https://unpkg.com/monaco-editor@latest/min/vs/loader.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1e1e1e;
            color: #ffffff;
        }

        .container {
            margin: 0 auto;
        }

        h1 {
            color: #ffffff;
            margin-bottom: 20px;
        }

        #editor-container {
            height: 700px;
            border: 1px solid #3e3e3e;
            border-radius: 4px;
            overflow: hidden;
        }

        .controls {
            margin-bottom: 20px;
        }

        button {
            background-color: #0e639c;
            color: white;
            border: none;
            padding: 8px 16px;
            margin-right: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        button:hover {
            background-color: #1177bb;
        }

        button:disabled {
            background-color: #666;
            cursor: not-allowed;
        }


        .deleted-code-decoration {
            background-color: rgba(244, 67, 54, 0.25);
            position: relative;
            opacity: 0.8;
            border-right: 2px solid #f44336;
        }

        .added-code-decoration {
            background-color: rgba(76, 175, 80, 0.25);
            border-right: 2px solid #4caf50;
            animation: slideInGreen 0s ease-out;
        }

        @keyframes slideInGreen {
            from {
                background-color: rgba(76, 175, 80, 0.5);
                border-right: 3px solid #4caf50;
            }
            to {
                background-color: rgba(76, 175, 80, 0.25);
                border-right: 2px solid #4caf50;
            }
        }

        /* Âª∫ËÆÆÊåâÈíÆÊ†∑Âºè */
        .suggestion-buttons {
            position: absolute;
            bottom: -2px;
            right: var(--button-offset-right, 4px); /* ÂèØËá™ÂÆö‰πâÁöÑÂè≥ÂÅèÁßªÈáè */
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.2s ease;
            transform: translateY(100%);
            /* width will be set dynamically via JavaScript */
        }

        .suggestion-buttons.visible {
            opacity: 1;
        }

        .suggestion-btn {
            background: rgba(30, 30, 30, 0.95);
            border: 1px solid #666;
            border-radius: 4px;
            padding: 2px 4px;
            font-size: 12px;
            cursor: pointer;
            color: #fff;
            float: right;
            line-height: 16px;
        }

        .suggestion-btn.accept {
            background: rgba(76, 175, 80, 0.8);
            border-color: #4caf50;
        }

        .suggestion-btn.accept:hover {
            background: rgba(76, 175, 80, 1);
        }

        .suggestion-btn.reject {
            background: rgba(244, 67, 54, 0.8);
            border-color: #f44336;
        }

        .suggestion-btn.reject:hover {
            background: rgba(244, 67, 54, 1);
        }

    </style>
</head>

<body>
    <div class="container">
        <h1>Monaco Editor - AI Code Suggestions Demo</h1>
        
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div class="controls">
                <button onclick="addSuggestion()">
                    ü§ñ AI Âª∫ËÆÆ
                </button>
                <button onclick="acceptSuggestions()">
                    ‚úÖ Êé•ÂèóÊâÄÊúâÂª∫ËÆÆ
                </button>
                <button onclick="resetCode()">
                    üîÑ ÈáçÁΩÆ‰ª£Á†Å
                </button>
            </div>
        </div>

        <div id="editor-container"></div>
    </div>

    <script>
        let editor;
        let suggestions = [];
        let decorationIds = [];
        let viewZoneIds = [];
        let suggestionWidgets = []; // Â≠òÂÇ®Âª∫ËÆÆÁöÑÊéß‰ª∂
        let initialCode = ''; // Â∞Ü‰ªéÂ§ñÈÉ®Êñá‰ª∂Âä†ËΩΩ

        // ÂºÇÊ≠•Âä†ËΩΩÂàùÂßã‰ª£Á†Å
        async function loadInitialCode() {
            try {
                const response = await fetch('./initial-code.js');
                initialCode = await response.text();
                if (editor) {
                    editor.setValue(initialCode);
                }
            } catch (error) {
                console.error('Failed to load initial code:', error);
            }
        }

        // ÂºÇÊ≠•Âä†ËΩΩÂª∫ËÆÆÈÖçÁΩÆ
        async function loadSuggestionConfig() {
            try {
                const response = await fetch('./suggestions-config.js');
                const configText = await response.text();
                
                // ‰ΩøÁî®evalÊâßË°åÈÖçÁΩÆÊñá‰ª∂‰ª£Á†ÅÔºàÂú®ÂÆûÈôÖÈ°πÁõÆ‰∏≠Âª∫ËÆÆ‰ΩøÁî®Êõ¥ÂÆâÂÖ®ÁöÑÊñπÊ≥ïÔºâ
                eval(configText);
                
                // Ê£ÄÊü•ÊòØÂê¶ÊàêÂäüÂä†ËΩΩ
                if (window.suggestionExamples && Array.isArray(window.suggestionExamples)) {
                    console.log(`Loaded ${window.suggestionExamples.length} suggestion examples`);
                } else {
                    console.error('Failed to load suggestion examples from config file');
                }
            } catch (error) {
                console.error('Failed to load suggestion config:', error);
            }
        }

        // Ëé∑ÂèñÁºñËæëÂô®ÂÆΩÂ∫¶ÁöÑËæÖÂä©ÂáΩÊï∞
        function getEditorWidth() {
            if (!editor) return 900; // ÈªòËÆ§ÂÆΩÂ∫¶‰Ωú‰∏∫ÂêéÂ§á
            
            const editorContainer = document.getElementById('editor-container');
            if (editorContainer) {
                return editorContainer.offsetWidth;
            }
            
            // Â¶ÇÊûúÊó†Ê≥ïËé∑ÂèñÂÆπÂô®ÂÆΩÂ∫¶ÔºåÂ∞ùËØï‰ªéÁºñËæëÂô®Êú¨Ë∫´Ëé∑Âèñ
            const editorDomNode = editor.getDomNode();
            if (editorDomNode) {
                return editorDomNode.offsetWidth;
            }
            
            return 900; // ÈªòËÆ§ÂêéÂ§áÂÆΩÂ∫¶
        }

        // Áªü‰∏ÄËÆæÁΩÆÂª∫ËÆÆÊåâÈíÆÂÆΩÂ∫¶ÁöÑÊñπÊ≥ï
        function setSuggestionButtonWidth(buttonElement) {
            if (buttonElement) {
                buttonElement.style.width = (getEditorWidth() - 200) + 'px';
            }
        }

        // Êõ¥Êñ∞ÊâÄÊúâÁé∞ÊúâÂª∫ËÆÆÊåâÈíÆÂÆΩÂ∫¶ÁöÑÊñπÊ≥ï
        function updateAllSuggestionButtonsWidth() {
            // --
            const suggestionButtons = document.querySelectorAll('.suggestion-buttons');
            // --
            suggestionButtons.forEach(button => {
                setSuggestionButtonWidth(button);
            });
        }

        // ÂàùÂßãÂåñ Monaco Editor
        require.config({
            paths: {
                vs: 'https://unpkg.com/monaco-editor@latest/min/vs'
            }
        });

        require(['vs/editor/editor.main'], function () {
            editor = monaco.editor.create(document.getElementById('editor-container'), {
                value: '// Ê≠£Âú®Âä†ËΩΩ‰ª£Á†Å...',
                language: 'javascript',
                theme: 'vs-dark',
                fontSize: 14,
                lineNumbers: 'on',
                minimap: {
                    enabled: true
                },
                scrollBeyondLastLine: false,
                automaticLayout: true,
                suggest: {
                    snippetsPreventQuickSuggestions: false,
                    showKeywords: true,
                    showSnippets: true
                }
            });
            
            // ÁºñËæëÂô®ÂàõÂª∫ÂÆåÊàêÂêéÂä†ËΩΩÂàùÂßã‰ª£Á†ÅÂíåÂª∫ËÆÆÈÖçÁΩÆ
            Promise.all([
                loadInitialCode(),
                loadSuggestionConfig()
            ]).then(() => {
                console.log('All configurations loaded successfully');
            }).catch(error => {
                console.error('Failed to load configurations:', error);
            });
            
            // Ê∑ªÂä†ÁºñËæëÂô®Â∏ÉÂ±ÄÂèòÂåñÁõëÂê¨Âô®ÔºåÂä®ÊÄÅÊõ¥Êñ∞Âª∫ËÆÆÊåâÈíÆÂÆΩÂ∫¶
            editor.onDidLayoutChange(function() {
                // Êõ¥Êñ∞ÊâÄÊúâÁé∞ÊúâÁöÑÂª∫ËÆÆÊåâÈíÆÂÆΩÂ∫¶
                updateAllSuggestionButtonsWidth();
            });
        });

        // Ê∑ªÂä† AI Âª∫ËÆÆ - Âõ∫ÂÆöÂª∫ËÆÆÁâàÊú¨ÔºåÂ∫îÁî®‰∏â‰∏™Âõ∫ÂÆöÁöÑÂª∫ËÆÆ
        function addSuggestion() {
            // Ëé∑ÂèñÊâÄÊúâÈÖçÁΩÆÁöÑÂª∫ËÆÆ
            const availableSuggestions = [...window.suggestionExamples || []];
            if (availableSuggestions.length === 0) {
                alert('No suggestions configured');
                return;
            }

            // Âõ∫ÂÆöÂ∫îÁî®ÊâÄÊúâÈÖçÁΩÆÁöÑÂª∫ËÆÆÔºàcreateUser„ÄÅprocessOrder„ÄÅÂà†Èô§filterActiveItemsÔºâ
            const selectedSuggestions = [];
            
            availableSuggestions.forEach((suggestion, index) => {
                const suggestionId = Date.now() + index; // Á°Æ‰øùÊØè‰∏™Âª∫ËÆÆÈÉΩÊúâÂîØ‰∏ÄID
                suggestion.id = suggestionId;
                selectedSuggestions.push(suggestion);
                
                console.log('Selected fixed AI suggestion with ID:', suggestionId, suggestion.description);
            });

            console.log(`Applying ${selectedSuggestions.length} fixed AI suggestions simultaneously`);

            // ÊåâÁÖßË°åÂè∑ÊéíÂ∫èÔºåÁ°Æ‰øù‰ªé‰∏äÂà∞‰∏ãÂ∫îÁî®ÔºàÈÅøÂÖçË°åÂè∑ÂÅèÁßªÈóÆÈ¢òÔºâ
            selectedSuggestions.sort((a, b) => a.range.startLineNumber - b.range.startLineNumber);

            // ÈÄê‰∏™Â∫îÁî®Âª∫ËÆÆÔºåÈúÄË¶ÅÊ≠£Á°ÆËÆ°ÁÆóË°åÂè∑ÂÅèÁßª
            let cumulativeLineOffset = 0;
            selectedSuggestions.forEach((suggestion, index) => {
                console.log(`\nApplying suggestion ${index + 1}: ${suggestion.description}`);
                console.log(`Original range: ${suggestion.range.startLineNumber}-${suggestion.range.endLineNumber}`);
                console.log(`Cumulative offset: ${cumulativeLineOffset}`);
                
                // Ë∞ÉÊï¥Âª∫ËÆÆÁöÑË°åÂè∑‰ª•Ë°•ÂÅø‰πãÂâçÊâÄÊúâ‰øÆÊîπÁöÑÁ¥ØÁßØÂÅèÁßª
                const adjustedSuggestion = {
                    ...suggestion,
                    range: {
                        ...suggestion.range,
                        startLineNumber: suggestion.range.startLineNumber + cumulativeLineOffset,
                        endLineNumber: suggestion.range.endLineNumber + cumulativeLineOffset
                    }
                };

                console.log(`Adjusted range: ${adjustedSuggestion.range.startLineNumber}-${adjustedSuggestion.range.endLineNumber}`);

                // ËÆ°ÁÆóÂΩìÂâçÂª∫ËÆÆÁöÑË°åÊï∞ÂèòÂåñ
                const linesBefore = suggestion.oldCode.split('\n').length;
                const linesAfter = suggestion.newCode.trim() === '' ? 0 : suggestion.newCode.split('\n').length;
                const currentLineDelta = linesAfter - linesBefore;
                
                console.log(`Lines before: ${linesBefore}, Lines after: ${linesAfter}, Delta: ${currentLineDelta}`);
                
                // Â∫îÁî®Âª∫ËÆÆ
                applySuggestionWithDiff(adjustedSuggestion);
                
                // Á¥ØÁßØÂÅèÁßªÈáèÔºåÂΩ±ÂìçÂêéÁª≠ÊâÄÊúâÂª∫ËÆÆÁöÑË°åÂè∑
                cumulativeLineOffset += currentLineDelta;
                console.log(`New cumulative offset: ${cumulativeLineOffset}`);
            });

            console.log(`Successfully applied ${selectedSuggestions.length} fixed suggestions`);
        }

        // Â∫îÁî®Âª∫ËÆÆÂπ∂ÊòæÁ§∫Â∑ÆÂºÇ - Êñ∞ÁâàÊú¨ÔºåÊ†áÁ∫¢‰ª£Á†Å‰∏çÂç†Ë°åÂè∑
        function applySuggestionWithDiff(suggestion) {
            const model = editor.getModel();
            
            // 1. ‰øùÂ≠òÂéüÂßã‰ª£Á†ÅÁî®‰∫éÂõûÊªö
            const originalCode = model.getValueInRange(new monaco.Range(
                suggestion.range.startLineNumber,
                suggestion.range.startColumn,
                suggestion.range.endLineNumber,
                suggestion.range.endColumn
            ));
            suggestion.originalCode = originalCode;
            
            // 2. ÂÖàÊ∑ªÂä†ËßÜËßâÂå∫ÂüüÊòæÁ§∫Ë¢´Âà†Èô§ÁöÑ‰ª£Á†ÅÔºàÂú®Âéü‰ª£Á†Å‰ΩçÁΩÆ‰∏äÊñπÔºå‰∏çÂç†Áî®ÂÆûÈôÖË°åÂè∑Ôºâ
            const deletedViewZone = {
                afterLineNumber: suggestion.range.startLineNumber - 1,
                heightInLines: originalCode.split('\n').length,
                domNode: createDeletedCodeNode(originalCode),
                suppressMouseDown: true
            };

            let currentViewZoneId;
            editor.changeViewZones(function(changeAccessor) {
                currentViewZoneId = changeAccessor.addZone(deletedViewZone);
                viewZoneIds.push(currentViewZoneId);
            });
            suggestion.viewZoneId = currentViewZoneId;

            // 3. Áõ¥Êé•ÊõøÊç¢Âéü‰ª£Á†Å‰∏∫Êñ∞‰ª£Á†Å
            let newRange;
            if (suggestion.newCode.trim() === '') {
                // ÂØπ‰∫éÂÆåÂÖ®Âà†Èô§ÁöÑÊÉÖÂÜµÔºåÈúÄË¶ÅÂà†Èô§Êï¥‰∏™ËåÉÂõ¥ÂåÖÊã¨Êç¢Ë°åÁ¨¶
                // Ê£ÄÊü•ÊòØÂê¶ÈúÄË¶ÅÂà†Èô§È¢ùÂ§ñÁöÑÊç¢Ë°åÁ¨¶
                const totalLines = model.getLineCount();
                let deleteRange;
                
                if (suggestion.range.endLineNumber < totalLines) {
                    // ‰∏çÊòØÊúÄÂêé‰∏ÄË°åÔºåÂà†Èô§Âà∞‰∏ã‰∏ÄË°åÁöÑÂºÄÂßãÔºàÂåÖÂê´Êç¢Ë°åÁ¨¶Ôºâ
                    deleteRange = new monaco.Range(
                        suggestion.range.startLineNumber,
                        1,
                        suggestion.range.endLineNumber + 1,
                        1
                    );
                } else {
                    // ÊòØÊúÄÂêé‰∏ÄË°åÔºåÂè™Âà†Èô§Âà∞Ë°åÂ∞æ
                    deleteRange = new monaco.Range(
                        suggestion.range.startLineNumber,
                        1,
                        suggestion.range.endLineNumber,
                        model.getLineMaxColumn(suggestion.range.endLineNumber)
                    );
                    
                    // Â¶ÇÊûú‰∏çÊòØÁ¨¨‰∏ÄË°åÔºåËøòÈúÄË¶ÅÂà†Èô§ÂâçÈù¢ÁöÑÊç¢Ë°åÁ¨¶
                    if (suggestion.range.startLineNumber > 1) {
                        deleteRange = new monaco.Range(
                            suggestion.range.startLineNumber - 1,
                            model.getLineMaxColumn(suggestion.range.startLineNumber - 1),
                            suggestion.range.endLineNumber,
                            model.getLineMaxColumn(suggestion.range.endLineNumber)
                        );
                    }
                }
                
                const edits = [{
                    range: deleteRange,
                    text: ''
                }];
                editor.executeEdits('ai-suggestion', edits);
                
                // Âà†Èô§Êìç‰Ωú‰∏çÈúÄË¶ÅÊñ∞ÁöÑËåÉÂõ¥Ôºå‰ΩøÁî®‰∏Ä‰∏™ÊúÄÂ∞èËåÉÂõ¥Áî®‰∫éÊåâÈíÆÂÆö‰Ωç
                newRange = new monaco.Range(
                    Math.max(1, suggestion.range.startLineNumber - 1),
                    1,
                    Math.max(1, suggestion.range.startLineNumber - 1),
                    1
                );
            } else {
                // Ê≠£Â∏∏ÊõøÊç¢Êìç‰Ωú
                const edits = [{
                    range: new monaco.Range(
                        suggestion.range.startLineNumber,
                        suggestion.range.startColumn,
                        suggestion.range.endLineNumber,
                        suggestion.range.endColumn
                    ),
                    text: suggestion.newCode
                }];
                editor.executeEdits('ai-suggestion', edits);
                
                // 4. ËÆ°ÁÆóÊñ∞‰ª£Á†ÅÁöÑË°åËåÉÂõ¥
                const newCodeLines = suggestion.newCode.split('\n').length;
                newRange = new monaco.Range(
                    suggestion.range.startLineNumber,
                    1,
                    suggestion.range.startLineNumber + newCodeLines - 1,
                    model.getLineMaxColumn(suggestion.range.startLineNumber + newCodeLines - 1)
                );
            }

            // 5. Á´ãÂç≥ÊªöÂä®Âà∞ÂèòÊõ¥‰ΩçÁΩÆÁ°Æ‰øùÂèØËßÅ
            editor.revealRangeInCenter(newRange, monaco.editor.ScrollType.Smooth);

            // 6. È´ò‰∫ÆÊñ∞Ê∑ªÂä†ÁöÑ‰ª£Á†ÅÔºàÂà†Èô§Êìç‰Ωú‰∏çÈúÄË¶ÅÈ´ò‰∫ÆÔºâ
            let addedDecoration = [];
            if (suggestion.newCode.trim() !== '') {
                addedDecoration = editor.deltaDecorations([], [{
                    range: newRange,
                    options: {
                        className: 'added-code-decoration',
                        isWholeLine: true,
                        stickiness: monaco.editor.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges
                    }
                }]);
            }

            // 7. ÂàõÂª∫Âª∫ËÆÆÊéßÂà∂ÊåâÈíÆ
            const buttonsWidget = createSuggestionButtonsWidget(suggestion, newRange, suggestion.newCode.trim() === '');
            editor.addContentWidget(buttonsWidget);

            // 8. Âº∫Âà∂Á´ãÂç≥ÈáçÁªòÁºñËæëÂô®‰ª•Á°Æ‰øùË£ÖÈ•∞Á´ãÂç≥ÊòæÁ§∫
            setTimeout(() => {
                editor.render(true);
            }, 0);

            // 9. Êõ¥Êñ∞Âª∫ËÆÆÁöÑËåÉÂõ¥‰ø°ÊÅØ‰ª•ÈÄÇÂ∫îÊñ∞‰ª£Á†Å
            suggestion.newRange = newRange;
            suggestion.decorationIds = addedDecoration;
            suggestion.widgetId = buttonsWidget.getId();

            // 10. ‰øùÂ≠òË£ÖÈ•∞ID„ÄÅÂª∫ËÆÆÊï∞ÊçÆÂíåÊéß‰ª∂
            decorationIds.push(...addedDecoration);
            suggestions.push(suggestion);
            suggestionWidgets.push(buttonsWidget);

            console.log(`Applied suggestion: ${suggestion.description} - Replaced code directly, showing deleted code in view zone above`);
        }

        // ÂàõÂª∫Âª∫ËÆÆÊåâÈíÆÊéß‰ª∂
        function createSuggestionButtonsWidget(suggestion, range, isDeleteOperation = false) {
            const widgetId = `suggestion-buttons-${suggestion.id}`;
            
            return {
                getId: function() {
                    return widgetId;
                },
                getDomNode: function() {
                    const buttonsContainer = document.createElement('div');
                    buttonsContainer.className = 'suggestion-buttons visible';
                    
                    // Âä®ÊÄÅËÆæÁΩÆÂÆΩÂ∫¶‰∏∫ÁºñËæëÂô®ÂÆΩÂ∫¶
                    setSuggestionButtonWidth(buttonsContainer);
                    
                    // Êé•ÂèóÊåâÈíÆ
                    const acceptBtn = document.createElement('button');
                    acceptBtn.className = 'suggestion-btn accept';
                    acceptBtn.innerHTML = '‚úì Êé•ÂèóÊ≠§Âª∫ËÆÆ';
                    acceptBtn.onclick = () => acceptIndividualSuggestion(suggestion.id);
                    
                    // ÊãíÁªùÊåâÈíÆ
                    const rejectBtn = document.createElement('button');
                    rejectBtn.className = 'suggestion-btn reject';
                    rejectBtn.innerHTML = '‚úï ÊãíÁªùÊ≠§Âª∫ËÆÆ';
                    rejectBtn.onclick = () => rejectIndividualSuggestion(suggestion.id);
                    
                    buttonsContainer.appendChild(acceptBtn);
                    buttonsContainer.appendChild(rejectBtn);
                    
                    return buttonsContainer;
                },
                getPosition: function() {
                    return {
                        position: {
                            lineNumber: range.endLineNumber,
                            // column: range.endColumn
                        },
                        preference: [monaco.editor.ContentWidgetPositionPreference.BELOW]
                    };
                }
            };
        }

        // ÂàõÂª∫ÊòæÁ§∫Ë¢´Âà†Èô§‰ª£Á†ÅÁöÑDOMËäÇÁÇπ
        function createDeletedCodeNode(deletedCode) {
            const node = document.createElement('div');
            
            // Ëé∑ÂèñÁºñËæëÂô®ÁöÑÂ≠ó‰ΩìÈÖçÁΩÆ
            const editorOptions = editor.getOptions();
            const fontSize = editorOptions.get(monaco.editor.EditorOption.fontSize);
            const lineHeight = editorOptions.get(monaco.editor.EditorOption.lineHeight);
            const fontFamily = editorOptions.get(monaco.editor.EditorOption.fontFamily);
            
            node.style.cssText = `
                background-color: rgba(82, 32, 27, 0.9);
                font-size: ${fontSize}px;
                line-height: ${lineHeight}px;
                font-family: ${fontFamily};
                color: #fff;
                opacity: 0.7;
                white-space: pre;
                overflow: hidden;
                padding: 0;
                margin: 0;
                padding-left: 4px;
            `;
            
            // ÂàõÂª∫‰ª£Á†ÅÂÆπÂô®Ôºå‰ΩøÁî®MonacoÁöÑËØ≠Ê≥ïÈ´ò‰∫ÆÊ†∑Âºè
            const codeContainer = document.createElement('pre');
            codeContainer.style.cssText = `
                margin: 0;
                padding: 0;
                font-family: inherit;
                font-size: inherit;
                line-height: inherit;
                color: inherit;
                background: transparent;
                white-space: pre;
                overflow: hidden;
            `;
            
            // Áõ¥Êé•ÊòæÁ§∫Ë¢´Âà†Èô§ÁöÑ‰ª£Á†Å
            codeContainer.textContent = deletedCode;
            node.appendChild(codeContainer);
            
            return node;
        }

        // Êé•ÂèóÂçï‰∏™Âª∫ËÆÆ
        function acceptIndividualSuggestion(suggestionId) {
            const suggestionIndex = suggestions.findIndex(s => s.id === suggestionId);
            if (suggestionIndex === -1) {
                console.log('Suggestion not found:', suggestionId);
                return;
            }
            
            const suggestion = suggestions[suggestionIndex];
            
            // 1. ÁßªÈô§ËØ•Âª∫ËÆÆÁöÑÈ´ò‰∫ÆË£ÖÈ•∞
            if (suggestion.decorationIds) {
                editor.deltaDecorations(suggestion.decorationIds, []);
                // ‰ªéÂÖ®Â±ÄdecorationIds‰∏≠ÁßªÈô§
                suggestion.decorationIds.forEach(id => {
                    const index = decorationIds.indexOf(id);
                    if (index > -1) decorationIds.splice(index, 1);
                });
            }
            
            // 2. ÁßªÈô§ÂØπÂ∫îÁöÑËßÜËßâÂå∫ÂüüÔºàË¢´Âà†Èô§ÁöÑ‰ª£Á†ÅÊòæÁ§∫Ôºâ
            if (suggestion.viewZoneId) {
                editor.changeViewZones(function(changeAccessor) {
                    changeAccessor.removeZone(suggestion.viewZoneId);
                });
                const index = viewZoneIds.indexOf(suggestion.viewZoneId);
                if (index > -1) viewZoneIds.splice(index, 1);
            }
            
            // 3. ÁßªÈô§ÊåâÈíÆÊéß‰ª∂
            if (suggestion.widgetId) {
                editor.removeContentWidget({getId: () => suggestion.widgetId});
                const widgetIndex = suggestionWidgets.findIndex(w => w.getId() === suggestion.widgetId);
                if (widgetIndex > -1) suggestionWidgets.splice(widgetIndex, 1);
            }
            
            // 4. ‰ªéÂª∫ËÆÆÂàóË°®‰∏≠ÁßªÈô§
            suggestions.splice(suggestionIndex, 1);
            
            console.log(`Accepted individual suggestion: ${suggestion.description}`);
        }

        // ÊãíÁªùÂçï‰∏™Âª∫ËÆÆ
        function rejectIndividualSuggestion(suggestionId) {
            const suggestionIndex = suggestions.findIndex(s => s.id === suggestionId);
            if (suggestionIndex === -1) {
                console.log('Suggestion not found:', suggestionId);
                return;
            }
            
            const suggestion = suggestions[suggestionIndex];
            
            // 1. ÁßªÈô§È´ò‰∫ÆË£ÖÈ•∞
            if (suggestion.decorationIds) {
                editor.deltaDecorations(suggestion.decorationIds, []);
                // ‰ªéÂÖ®Â±ÄdecorationIds‰∏≠ÁßªÈô§
                suggestion.decorationIds.forEach(id => {
                    const index = decorationIds.indexOf(id);
                    if (index > -1) decorationIds.splice(index, 1);
                });
            }
            
            // 2. ÁßªÈô§ËßÜËßâÂå∫Âüü
            if (suggestion.viewZoneId) {
                editor.changeViewZones(function(changeAccessor) {
                    changeAccessor.removeZone(suggestion.viewZoneId);
                });
                const index = viewZoneIds.indexOf(suggestion.viewZoneId);
                if (index > -1) viewZoneIds.splice(index, 1);
            }
            
            // 3. ÁßªÈô§ÊåâÈíÆÊéß‰ª∂
            if (suggestion.widgetId) {
                editor.removeContentWidget({getId: () => suggestion.widgetId});
                const widgetIndex = suggestionWidgets.findIndex(w => w.getId() === suggestion.widgetId);
                if (widgetIndex > -1) suggestionWidgets.splice(widgetIndex, 1);
            }
            
            // 4. ÊÅ¢Â§çÂéüÂßã‰ª£Á†Å
            if (suggestion.originalCode && suggestion.newRange) {
                const edits = [{
                    range: suggestion.newRange,
                    text: suggestion.originalCode
                }];
                editor.executeEdits('reject-suggestion', edits);
            }
            
            // 5. ‰ªéÂª∫ËÆÆÂàóË°®‰∏≠ÁßªÈô§
            suggestions.splice(suggestionIndex, 1);
            
            console.log(`Rejected individual suggestion: ${suggestion.description}`);
        }

        // Êé•ÂèóÊâÄÊúâ AI Âª∫ËÆÆ - Ê∏ÖÁêÜË£ÖÈ•∞ÂíåËßÜËßâÂå∫ÂüüÔºå‰øùÁïôÂ∑≤ÊõøÊç¢ÁöÑ‰ª£Á†Å
        function acceptSuggestions() {
            if (suggestions.length === 0) {
                console.log('No suggestions to accept');
                return;
            }
            
            // ÈÄê‰∏™Êé•ÂèóÊâÄÊúâÂª∫ËÆÆ
            const suggestionIds = suggestions.map(s => s.id);
            suggestionIds.forEach(id => acceptIndividualSuggestion(id));
            
            console.log('Accepted all AI suggestions');
        }
        
        // ÊãíÁªùÊâÄÊúâÂª∫ËÆÆ - ÊÅ¢Â§çÂà∞ÂàùÂßã‰ª£Á†Å
        function resetCode() {
            // 1. Ê∏ÖÁêÜÊâÄÊúâË£ÖÈ•∞
            if (decorationIds.length > 0) {
                editor.deltaDecorations(decorationIds, []);
            }
            
            // 2. Ê∏ÖÁêÜÊâÄÊúâËßÜËßâÂå∫Âüü
            if (viewZoneIds.length > 0) {
                editor.changeViewZones(function(changeAccessor) {
                    viewZoneIds.forEach(id => {
                        changeAccessor.removeZone(id);
                    });
                });
            }
            
            // 3. Ê∏ÖÁêÜÊâÄÊúâÊéß‰ª∂
            suggestionWidgets.forEach(widget => {
                editor.removeContentWidget(widget);
            });
            
            // 4. ÊÅ¢Â§çÂà∞ÂàùÂßã‰ª£Á†Å
            editor.setValue(initialCode);
            
            // 5. Ê∏ÖÁêÜÂèòÈáèÁä∂ÊÄÅ
            suggestions = [];
            decorationIds = [];
            viewZoneIds = [];
            suggestionWidgets = [];
            
            console.log('Rejected all AI suggestions: restored original code');
        }

        // Á°Æ‰øùÂáΩÊï∞Âú®ÂÖ®Â±Ä‰ΩúÁî®Âüü‰∏≠ÂèØËÆøÈóÆ
        window.addSuggestion = addSuggestion;
        window.acceptSuggestions = acceptSuggestions;
        window.resetCode = resetCode;
    </script>
</body>

</html>